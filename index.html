<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–®–∫–æ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ ‚Äî Online</title>
<style>
  :root{--bg:#0b1220;--muted:#7e8aa3;--text:#e8eefc}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 800px at 20% -10%,#142040 0%,#0b1220 60%);
       font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--text)}
  .wrap{max-width:800px;margin:0 auto;padding:20px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
  .title{font-weight:800;letter-spacing:.5px;font-size:clamp(22px,3vw,36px);display:flex;align-items:center;gap:10px}
  .title img{height:36px;width:36px;object-fit:contain}
  .subtitle{color:#7e8aa3;font-size:clamp(12px,1.5vw,16px)}
  .grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:16px}
  .tile{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));
        border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:12px 14px;box-shadow:0 4px 12px rgba(0,0,0,.25)}
  .left{display:flex;align-items:center;gap:12px;min-width:0}
  .rank{width:36px;height:36px;border-radius:8px;display:grid;place-items:center;font-weight:800;background:#0f1730;border:1px solid rgba(255,255,255,.08)}
  .name{font-weight:700;letter-spacing:.3px;font-size:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .right{display:flex;align-items:center;gap:12px}
  .score{font-weight:800;min-width:48px;text-align:right;font-size:18px}
  .medal{font-size:24px}
  .footer{margin-top:12px;display:flex;justify-content:space-between;color:#7e8aa3;font-size:12px}
  .blink{animation:blink 1.2s linear infinite}@keyframes blink{50%{opacity:.35}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <div class="title">
        <img src="data:image/png;base64,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" alt="Batman">
        –®–∫–æ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ ‚Äî Online
      </div>
      <div class="subtitle">–ò—Å—Ç–æ—á–Ω–∏–∫: Google Sheets (–õ–∏—Å—Ç2, CSV). –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.</div>
    </div>
    <div class="subtitle" id="status">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
  </header>

  <div id="grid" class="grid"></div>

  <div class="footer">
    <span id="updated"></span>
    <span>–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (F11) –Ω–∞ –¢–í</span>
  </div>
</div>

<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-yAedPlzSiucopAyXDGUCa4NC8sSVW1e6yxsFXksSIgxTkJhkONG6daXkg2Y8cGwaqsrffbt22_Py/pub?gid=1022445244&single=true&output=csv";
  const REFRESH_MS = 5000;

  const gridEl = document.getElementById('grid');
  const statusEl = document.getElementById('status');
  const updatedEl = document.getElementById('updated');

  const medalOrder = { gold:0, silver:1, bronze:2, "":3 };
  function medalType(str){
    const s = (str||'').toLowerCase();
    if (s.includes('–∑–æ–ª') || s.includes('gold')) return 'gold';
    if (s.includes('—Å–µ—Ä') || s.includes('silver')) return 'silver';
    if (s.includes('–±—Ä–æ–Ω')|| s.includes('bronze')) return 'bronze';
    return '';
  }
  function medalEmoji(type){ return type==='gold'?'ü•á':type==='silver'?'ü•à':type==='bronze'?'ü•â':''; }

  async function fetchCSV(){
    try{
      statusEl.innerHTML = '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ‚Ä¶ <span class="blink">‚óè</span>';
      const res = await fetch(CSV_URL + '&_=' + Date.now(), {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const text = await res.text();

      const parsed = Papa.parse(text, { skipEmptyLines: "greedy" });
      render(parsed.data);
      statusEl.textContent = '–û–±–Ω–æ–≤–ª–µ–Ω–æ';
      updatedEl.textContent = '–í—Ä–µ–º—è: ' + new Date().toLocaleTimeString();
    }catch(e){
      statusEl.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV';
      console.error(e);
    }
  }

  function render(rows){
    if(!rows || rows.length===0){ gridEl.innerHTML=''; return; }

    const header = rows[0].map(h => (h||'').toString().trim().toLowerCase());
    const hasHdr = header.some(h => h.includes('—Ñ–∏–æ')||h.includes('name')||h.includes('–∏—Ç–æ–≥–æ')||h.includes('score')||h.includes('–º–µ–¥–∞–ª')||h.includes('medal'));
    const body = rows.slice(hasHdr?1:0);

    let idxName  = hasHdr ? header.findIndex(h=>h.includes('—Ñ–∏–æ')||h.includes('name'))   : 0;
    let idxScore = hasHdr ? header.findIndex(h=>h.includes('–∏—Ç–æ–≥–æ')||h.includes('score')) : 1;
    let idxMedal = hasHdr ? header.findIndex(h=>h.includes('–º–µ–¥–∞–ª')||h.includes('medal')) : 2;
    if(idxName<0) idxName=0; if(idxScore<0) idxScore=1; if(idxMedal<0) idxMedal=2;

    const data = body.map(r=>{
      const name  = (r[idxName]  ?? '').toString().trim();
      const score = parseFloat((r[idxScore] ?? '0').toString().replace(',','.')) || 0;
      const medal = (r[idxMedal] ?? '').toString().trim();
      return { name, score: Math.round(score), medal };
    }).filter(r=>r.name);

    data.sort((a,b)=>{
      const ma = medalType(a.medal), mb = medalType(b.medal);
      const byM = medalOrder[ma]-medalOrder[mb]; if(byM) return byM;
      const byS = (b.score||0)-(a.score||0);      if(byS) return byS;
      return a.name.localeCompare(b.name,'ru');
    });

    gridEl.innerHTML='';
    data.forEach((row,i)=>{
      const t = medalType(row.medal), e = medalEmoji(t);
      const el = document.createElement('div'); el.className='tile';
      el.innerHTML = `
        <div class="left">
          <div class="rank">${i+1}</div>
          <div class="name">${e?e+' ':''}${row.name}</div>
        </div>
        <div class="right">
          ${e?`<div class="medal" data-type="${t}">${e}</div>`:''}
          <div class="score">${row.score}</div>
        </div>`;
      gridEl.appendChild(el);
    });
  }

  fetchCSV();
  setInterval(fetchCSV, REFRESH_MS);
</script>
</body>
</html>



